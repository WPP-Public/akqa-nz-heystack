#!/usr/bin/env php
<?php

/**
 * Use the bootstrap to ensure all environment based configs and autoloader are ready
 */
require_once __DIR__ . '/../code/bootstrap.php';

/**
 * Get the container
 */
$container = Heystack\Subsystem\Core\ServiceStore::get();

/**
 * If the container in use doesn't have console.application then there is a big problem
 */
if (!$container->has('console.application')) {
    unlink(HEYSTACK_BASE_PATH . '/cache/HeystackServiceContainer' . Director::get_environment_type() . '.php');
    echo 'There appears to be a problem with your container. The service \'console.application\' must exist.', PHP_EOL;
    echo 'The current container has been deleted, please make the required modifications', PHP_EOL;
    exit(1);
}

/**
 * Everything appears in order, run the application
 */
$container->get('console.application')->run();
